<div class="row justify-content-center">
  <div class="col-lg-8">
    <div class="card shadow-sm">
      <div class="card-body">
        <h1 class="h4 mb-3">Purchase Order Request</h1>
        <p class="text-muted mb-4">
          Fill this form to request a PO number. After submission, share the PO
          number with your vendor and include it on the invoice.
        </p>

        <% if (error) { %>
          <div class="alert alert-danger"><%= error %></div>
        <% } %>

        <% if (submitted && po) { %>
          <div class="alert alert-success">
            <strong>Request submitted!</strong><br />
            Your PO Number is:
            <span class="fw-bold"><%= po.poNumber %></span>
          </div>
        <% } %>

        <form method="POST" action="/request" enctype="multipart/form-data">
          <div class="mb-3">
            <label class="form-label">Requester Name *</label>
            <input type="text" name="requesterName" class="form-control" required />
          </div>

          <div class="mb-3">
            <label class="form-label">Requester Email</label>
            <input type="email" name="requesterEmail" class="form-control" />
          </div>

          <div class="mb-3">
            <label class="form-label">Division *</label>
            <select name="division" class="form-select" required>
              <option value="">Select...</option>
              <option value="FL">FL</option>
              <option value="GA ROOF">GA ROOF</option>
              <option value="OK">OK</option>
              <option value="GA SAV">GA SAV</option>
              <option value="OTHER">OTHER</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Job Number (Optional)</label>
            <input
              type="text"
              name="jobNumber"
              class="form-control"
              placeholder="Example: WR 117780148, OK1175, GA 20655"
            />
          </div>

          <div class="mb-3">
            <label class="form-label">Category (Optional)</label>
            <select name="category" class="form-select">
              <option value="">Select...</option>
              <option value="Materials">Materials</option>
              <option value="Repairs & Maintenance">Repairs & Maintenance</option>
              <option value="Equipment Rental">Equipment Rental</option>
              <option value="Travel">Travel</option>
              <option value="Fuel">Fuel</option>
              <option value="Subcontractor">Subcontractor</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Vendor Name *</label>
            <input type="text" name="vendorName" class="form-control" required />
          </div>

          <div class="mb-3">
            <label class="form-label">Description of Purchase *</label>
            <textarea
              name="description"
              rows="3"
              class="form-control"
              placeholder="Example: Truck #214 repairs, hydraulic hose, etc."
              required
            ></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label">Estimated Amount (USD) *</label>
            <input
              type="number"
              step="0.01"
              min="0"
              name="amount"
              class="form-control"
              required
            />
          </div>

          <div class="mb-3">
            <label class="form-label">Attachment (Quote / Receipt, optional)</label>
            <input type="file" name="attachment" class="form-control" />
            <div class="form-text">
              You can upload a quote, estimate, or supporting document (PDF, image, etc.).
            </div>
          </div>

          <button type="submit" class="btn btn-primary">
            Submit Request
          </button>
        </form>
      </div>
    </div>

    <% if (submitted && po) { %>
      <div class="card shadow-sm mt-4">
        <div class="card-body">
          <h2 class="h5 mb-3">Request Details</h2>
          <dl class="row mb-0">
            <dt class="col-sm-3">PO Number</dt>
            <dd class="col-sm-9"><code><%= po.poNumber %></code></dd>

            <dt class="col-sm-3">Requester</dt>
            <dd class="col-sm-9"><%= po.requesterName %></dd>

            <dt class="col-sm-3">Division</dt>
            <dd class="col-sm-9"><%= po.division %></dd>

            <dt class="col-sm-3">Job Number</dt>
            <dd class="col-sm-9"><%= po.jobNumber || 'N/A' %></dd>

            <dt class="col-sm-3">Category</dt>
            <dd class="col-sm-9"><%= po.category || 'N/A' %></dd>

            <dt class="col-sm-3">Vendor</dt>
            <dd class="col-sm-9"><%= po.vendorName %></dd>

            <dt class="col-sm-3">Amount</dt>
            <dd class="col-sm-9"><%= formatCurrency(po.amount) %></dd>

            <dt class="col-sm-3">Status</dt>
            <dd class="col-sm-9">
              <span class="badge bg-warning text-dark"><%= po.status %></span>
            </dd>

            <% if (po.attachmentPath) { %>
              <dt class="col-sm-3">Attachment</dt>
              <dd class="col-sm-9">
                <a href="<%= po.attachmentPath %>" target="_blank">
                  <%= po.attachmentOriginalName || 'Download file' %>
                </a>
              </dd>
            <% } %>
          </dl>
        </div>
      </div>
    <% } %>
  </div>
</div>
